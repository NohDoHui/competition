---
title: "sub트레인데이터 작업"
output: html_notebook
---

```{r}
library(rmarkdown)
library(knitr)
library(data.table)
library(dplyr)
```

워킹디렉토리 설정 및, 디렉션 확인, 트레인데이터 목록 리스트화
```{r}
getwd()
setwd('~/Documents/원자력발전소_공모전/train')
getwd() 
dir() %>% table() %>% sum()
train.list <- dir() %>% list()
```


PCA작업for id=0
```{r}
sapply(data0[,2:length(names(data0))], class) %>% table  #check data class
data0.scaled <- sapply(data0[,2:length(names(data0))], scale) %>% as.data.frame() #data scaling

col_na0 = NULL
for (i in 1:length(names(data0.scaled))) {  #NA's check
  e1 = sum(is.na(data0.scaled[,i]))
  col_na0 <- rbind(col_na0, e1) %>% data.frame()
}
file0 <- data0.scaled[, colSums(is.na(data0.scaled)) != nrow(data0.scaled)] #Remove NA colums

secu_prcomp0 <- prcomp(file0)
options(max.print=1000000)
summary(secu_prcomp0)
file0.rot <- secu_prcomp0$rotation %>% data.frame() #data frame for PC's components
```
PCA 결과 특정 어느 변수들이 변수들간의 상관관계를 설명하는데 강한 영향력을 끼치고 있는 것을
발견하기 어려웠다. 모든 변수들이 조금조금씩 설명력을 가지는데에 지분이 있었음.





Append train data(id=0~id=9)
워킹 디렉토리 설정 및 트레인 라벨 데이터 가져오기
```{r}
setwd('~/Documents/원자력발전소_공모전')
train_label <- fread('train_label.csv') %>% as.data.frame()

setwd('~/Documents/원자력발전소_공모전/train')
getwd()
```

0.csv~9.csv 트레인 데이터 가져와서 리스트로 합치고, 데이터 벡터용량이 부족한 관계로 합친 후 각각의 데이터는 제거
```{r}
for (i in 1:10) { 
  file.name <- paste0('data',i-1)
  assign(file.name, fread(train.list[[1]][i]) %>% data.frame())   #loadding data
}

list.frame <- mget(ls(pattern = 'data')) #From data.frame, to list
rm(list=ls(pattern = 'data')) #clean up the environment
```

각각의 데이터에 맞는 id, label값을 추가한 뒤 어팬드.
```{r}
apd.data <- NULL
for (i in 1:10) {
  list.frame[[i]] <- transform(list.frame[[i]],
                               label = train_label[i,2],   #creating 'id'&'label'
                               id = i-1)
  apd.data <- rbind(apd.data, list.frame[[i]])   #appending data
}
```

어팬드 한 뒤, 데이터들의 클래스 확인>> 전부 숫자.
스케일링 작업 실시.
스케일링 작업 후에 NA가 발생한 칼럼을 확인, 전체 행이 6000개인데, 모든 행값이 6000으로 바뀐 칼럼들만 존재. 즉, 모든 행값이 동일한 숫자인 경우인거같음.
NA칼럼들 쳐내고, 스케일링된 데이터에 id, label 붙여넣기
```{r}
sapply(apd.data[,2:5122], class) %>% table  #check class of data >> all numeric
scaled <- sapply(apd.data[,2:5122], scale) %>% as.data.frame() #data scaling

col_na = NULL
for (i in 1:length(names(scaled))) {  #NA's check 
  e1 = sum(is.na(scaled[,i]))
  col_na <- rbind(col_na, e1) %>% data.frame()
  colnames(col_na) <- 'num_na'
}
col_na %>% table()

scaled <- scaled[, colSums(is.na(scaled)) != nrow(scaled)] #Remove NAs
scaled <- transform(scaled, #Creating 'id'&'label' to scaled data
                    id = apd.data$id,
                    label = apd.data$label)

```

sub_data로 전처리 완료된 데이터를 복사해두기(작업하다가 실수할지 혹시 모르니까)
그리고 필요한 데이터들 environment에서 제거
```{r}
sub_data <- scaled
{rm(apd.data)
  rm(col_na)
  rm(list.frame)
  rm(train.list)
  rm(train_label)}
```


